openapi: 3.0.0
info:
  title: SELVA
  version: 1.0.0
  description: Soluciones Electrónicas Locales de Valor
servers:
  - url: https://dev.selva.fi.cr
  - url: https://selva.fi.cr
paths:
  /api/user:
    get:
      summary: Get User
      responses:
        "200":
          description: User retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      name:
                        type: string
                      email:
                        type: string
                        format: email
                      email_verified_at:
                        type: string
                        format: date-time
                        nullable: true
                      created_at:
                        type: string
                        format: date-time
                      updated_at:
                        type: string
                        format: date-time
              example:
                success: true
                message: User retrieved successfully
                data:
                  id: d37da6d4-c34c-44e9-bb00-7273a378a5ad
                  name: Philippe Lamy
                  email: philippe@selva.com
                  email_verified_at: null
                  created_at: 2025-12-12T13:30:05.000000Z
                  updated_at: 2025-12-12T13:31:58.000000Z
        "401":
          description: Unauthenticated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    nullable: true
                  errors:
                    type: object
              example:
                success: false
                message: Unauthenticated.
                data: null
                errors: {}
      tags:
        - User
      security:
        - BearerAuth: []
  /api/payments:
    post:
      summary: Send Payment
      parameters:
        - name: X-Idempotency-Key
          in: header
          required: true
          deprecated: false
          schema: {}
          example: "UUID"
      responses:
        "201":
          description: Payment initiated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      payment_id:
                        type: string
                        format: uuid
                      payment_type:
                        type: string
                      status:
                        type: string
                      channel_reference:
                        type: string
              example:
                success: true
                message: Payment initiated successfully
                data:
                  payment_id: 5e74bd6c-46c5-4933-b46a-bb081e71663e
                  payment_type: pin
                  status: pending
                  channel_reference: "2025123100001198137477666"
        "409":
          description: Already use X-Idempotency-Key (duplicated request)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    nullable: true
                  errors:
                    type: object
                    properties:
                      payment_id:
                        type: string
                        format: uuid
                      payment_type:
                        type: string
                      status:
                        type: string
              example:
                success: false
                message: Payment already processed
                data: null
                errors:
                  payment_id: 122434f8-0b17-4aa3-8063-d8baf978b617
                  payment_type: pin
                  status: pending
        "422":
          description: Validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    nullable: true
                  errors:
                    type: object
                    additionalProperties:
                      type: array
                      items:
                        type: string
              examples:
                Single Validation Error:
                  value:
                    success: false
                    message: Amount exceeds maximum limit
                    data: null
                    errors:
                      amount:
                        - Amount exceeds maximum limit
                Multiple Validation Errors:
                  value:
                    success: false
                    message: Source account does not exist
                    data: null
                    errors:
                      from_account_id:
                        - Source account does not exist
                        - You do not own this account
                      amount:
                        - Amount exceeds maximum limit
                Both Recipient Fields Provided:
                  value:
                    success: false
                    message: Only one recipient field should be provided
                    data: null
                    errors:
                      recipient:
                        - Cannot provide both recipient_iban and recipient_phone
                Missing Idempotency Key:
                  value:
                    success: false
                    message: X-Idempotency-Key header is required
                    data: null
                    errors:
                      X-Idempotency-Key:
                        - X-Idempotency-Key header is required
      tags:
        - Payments
      security:
        - BearerAuth: []
      requestBody:
        description: Either recipient_iban or recipient_phone must be provided (not both). If both are provided, the API will return a validation error.
        content:
          application/json:
            schema:
              type: object
              required:
                - from_account_id
                - amount
              properties:
                from_account_id:
                  type: string
                  description: Source account ID
                amount:
                  type: number
                  description: Payment amount
                recipient_iban:
                  $ref: "#/components/schemas/CostaRicaIBAN"
                  description: Recipient IBAN (required if recipient_phone not provided)
                recipient_phone:
                  $ref: "#/components/schemas/CostaRicaPhone"
                  description: Recipient phone number (required if recipient_iban not provided)
                recipient_email:
                  type: string
                  description: Recipient email (optional)
                description:
                  type: string
                  description: Payment description (optional)
                reference:
                  type: string
                  description: Payment reference (optional)
            examples:
              PIN Transfer:
                value:
                  from_account_id: 70242935-a11b-4018-8e84-0413a8ac9d67
                  amount: 1000
                  recipient_iban: CR02010200000000000001
              SINPE Móvil Transfer:
                value:
                  from_account_id: 70242935-a11b-4018-8e84-0413a8ac9d67
                  amount: 2500
                  recipient_phone: "88881234"
  /api/payments/validate:
    post:
      summary: Validate Payment
      description: Validates payment details without initiating the transaction. Returns validation status and any errors.
      parameters:
        - name: X-Idempotency-Key
          in: header
          required: true
          deprecated: false
          schema: {}
          example: "UUID"
      responses:
        "200":
          description: Payment validated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      payment_type:
                        type: string
                      estimated_fees:
                        type: object
                        properties:
                          base_fee:
                            type: number
                          currency:
                            type: string
                          total_fee:
                            type: number
                      service_available:
                        type: boolean
              example:
                success: true
                message: Payment data is valid
                data:
                  payment_type: pin
                  estimated_fees:
                    base_fee: 2
                    currency: CRC
                    total_fee: 2
                  service_available: true
        "409":
          description: Duplicate request (X-Idempotency-Key already used)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    nullable: true
                  errors:
                    type: object
              example:
                success: false
                message: Payment already processed
                data: null
                errors: {}
        "422":
          description: Validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    nullable: true
                  errors:
                    type: object
                    additionalProperties:
                      type: array
                      items:
                        type: string
              examples:
                Missing Idempotency Key:
                  value:
                    success: false
                    message: X-Idempotency-Key header is required
                    data: null
                    errors:
                      X-Idempotency-Key:
                        - X-Idempotency-Key header is required
                Both Recipient Fields Provided:
                  value:
                    success: false
                    message: Cannot specify both IBAN and phone number for recipient
                    data: null
                    errors:
                      recipient:
                        - Cannot specify both IBAN and phone number for recipient
                Negative Amount:
                  value:
                    success: false
                    message: The amount must be greater than 0
                    data: null
                    errors:
                      amount:
                        - The amount must be greater than 0
      tags:
        - Payments
      security:
        - BearerAuth: []
      requestBody:
        description: Either recipient_iban or recipient_phone must be provided (not both). If both are provided, the API will return a validation error.
        content:
          application/json:
            schema:
              type: object
              required:
                - from_account_id
                - amount
              properties:
                from_account_id:
                  type: string
                  description: Source account ID
                amount:
                  type: number
                  description: Payment amount
                recipient_iban:
                  $ref: "#/components/schemas/CostaRicaIBAN"
                  description: Recipient IBAN (required if recipient_phone not provided)
                recipient_phone:
                  $ref: "#/components/schemas/CostaRicaPhone"
                  description: Recipient phone number (required if recipient_iban not provided)
                recipient_email:
                  type: string
                  description: Recipient email (optional)
                description:
                  type: string
                  description: Payment description (optional)
                reference:
                  type: string
                  description: Payment reference (optional)
            examples:
              With IBAN:
                value:
                  from_account_id: 70242935-a11b-4018-8e84-0413a8ac9d67
                  amount: 1000
                  recipient_iban: CR02010200000000000001
              With Phone:
                value:
                  from_account_id: 70242935-a11b-4018-8e84-0413a8ac9d67
                  amount: 2500
                  recipient_phone: "88881234"
  /api/payments/{id}:
    get:
      summary: Get Payment Details
      responses:
        "200":
          description: Payment status retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      idempotency_key:
                        type: string
                        format: uuid
                      transfer_type:
                        type: string
                        enum: [debit, credit]
                      channel_ref_number:
                        type: string
                      cgp_ref_number:
                        type: integer
                      sinpe_ref:
                        type: string
                      status:
                        type: string
                        enum: [pending, completed, failed, cancelled]
                      amount:
                        type: object
                        properties:
                          value:
                            type: string
                          currency:
                            type: string
                          formatted:
                            type: string
                      description:
                        type: string
                        nullable: true
                      reference:
                        type: string
                        nullable: true
                      error_message:
                        type: string
                        nullable: true
                      created_at:
                        type: string
                        format: date-time
                      submitted_at:
                        type: string
                        format: date-time
                      completed_at:
                        type: string
                        format: date-time
                        nullable: true
                      payment_type:
                        type: string
                        enum: [pin, sinpe]
                      payer:
                        type: object
                        properties:
                          iban:
                            $ref: "#/components/schemas/CostaRicaIBAN"
                          document_number:
                            type: string
                          currency:
                            type: string
                      payee:
                        type: object
                        properties:
                          document_number:
                            type: string
                          iban:
                            $ref: "#/components/schemas/CostaRicaIBAN"
                          currency:
                            type: string
              example:
                success: true
                message: Payment status retrieved successfully
                data:
                  id: b0087967-dbd9-4692-a4a7-ccb8f1289304
                  idempotency_key: AF282409-9105-4BFF-8F90-8DC8322CCDF8
                  transfer_type: debit
                  channel_ref_number: "2025123100001683790515175"
                  cgp_ref_number: 10255
                  sinpe_ref: "2025123137022010000102551"
                  status: completed
                  amount:
                    value: "10.00"
                    currency: CRC
                    formatted: "10.00 CRC"
                  description: null
                  reference: null
                  error_message: null
                  created_at: "2025-12-31T22:48:45.000000Z"
                  submitted_at: "2025-12-31T22:48:51.000000Z"
                  completed_at: "2025-12-31T22:48:51.000000Z"
                  payment_type: pin
                  payer:
                    iban: CR17037010600841438269
                    document_number: "07-1111-1118"
                    currency: CRC
                  payee:
                    document_number: "01-0111-0114"
                    iban: CR02010200000000000001
                    currency: CRC
        "422":
          description: Validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    nullable: true
                  errors:
                    type: object
                    additionalProperties:
                      type: array
                      items:
                        type: string
              example:
                success: false
                message: Payment ID must be a valid UUID
                data: null
                errors:
                  payment_id:
                    - Payment ID must be a valid UUID
        "404":
          description: Payment not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    nullable: true
                  errors:
                    type: object
              example:
                success: false
                message: Payment not found
                data: null
                errors: {}
      tags:
        - Payments
      security:
        - BearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
  /api/payments/history:
    get:
      summary: Get Historical Transfers
      parameters:
        - name: payment_method
          in: query
          required: false
          deprecated: false
          schema:
            type: string
            enum: [pin, sinpe]
          example: pin
        - name: transfer_type
          in: query
          required: false
          deprecated: false
          schema:
            type: string
            enum: [debit, credit]
          example: debit
        - name: recipient_identifier
          in: query
          required: false
          deprecated: false
          schema:
            $ref: "#/components/schemas/CostaRicaNationalIdentifier"
          example: "111090807"
        - name: limit
          in: query
          required: false
          deprecated: false
          schema:
            type: integer
            minimum: 1
            maximum: 1000
          example: 10
        - name: offset
          in: query
          required: false
          deprecated: false
          schema:
            type: integer
            minimum: 0
          example: 0
      responses:
        "200":
          description: Payment history retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      payments:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              format: uuid
                            idempotency_key:
                              type: string
                              format: uuid
                            transfer_type:
                              type: string
                              enum: [debit, credit]
                            channel_ref_number:
                              type: string
                            cgp_ref_number:
                              type: integer
                            sinpe_ref:
                              type: string
                            status:
                              type: string
                              enum: [pending, completed, failed, cancelled]
                            amount:
                              type: object
                              properties:
                                value:
                                  type: string
                                currency:
                                  type: string
                                formatted:
                                  type: string
                            description:
                              type: string
                              nullable: true
                            reference:
                              type: string
                              nullable: true
                            error_message:
                              type: string
                              nullable: true
                            created_at:
                              type: string
                              format: date-time
                            submitted_at:
                              type: string
                              format: date-time
                            completed_at:
                              type: string
                              format: date-time
                              nullable: true
                            payment_type:
                              type: string
                              enum: [pin, sinpe]
                            payer:
                              type: object
                              properties:
                                iban:
                                  $ref: "#/components/schemas/CostaRicaIBAN"
                                document_number:
                                  type: string
                                currency:
                                  type: string
                            payee:
                              type: object
                              properties:
                                document_number:
                                  type: string
                                iban:
                                  $ref: "#/components/schemas/CostaRicaIBAN"
                                currency:
                                  type: string
                      count:
                        type: integer
              examples:
                With Items:
                  value:
                    success: true
                    message: Payment history retrieved successfully
                    data:
                      payments:
                        - id: b0087967-dbd9-4692-a4a7-ccb8f1289304
                          idempotency_key: AF282409-9105-4BFF-8F90-8DC8322CCDF8
                          transfer_type: debit
                          channel_ref_number: "2025123100001683790515175"
                          cgp_ref_number: 10255
                          sinpe_ref: "2025123137022010000102551"
                          status: completed
                          amount:
                            value: "10.00"
                            currency: CRC
                            formatted: "10.00 CRC"
                          description: null
                          reference: null
                          error_message: null
                          created_at: "2025-12-31T22:48:45.000000Z"
                          submitted_at: "2025-12-31T22:48:51.000000Z"
                          completed_at: "2025-12-31T22:48:51.000000Z"
                          payment_type: pin
                          payer:
                            iban: CR17037010600841438269
                            document_number: "07-1111-1118"
                            currency: CRC
                          payee:
                            document_number: "01-0111-0114"
                            iban: CR02010200000000000001
                            currency: CRC
                      count: 1
                Empty:
                  value:
                    success: true
                    message: Payment history retrieved successfully
                    data:
                      payments: []
                      count: 0
        "422":
          description: Validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    nullable: true
                  errors:
                    type: object
                    additionalProperties:
                      type: array
                      items:
                        type: string
              example:
                success: false
                message: Invalid payment_method, must be "pin" or "sinpe"
                data: null
                errors:
                  payment_method:
                    - Invalid payment_method, must be "pin" or "sinpe"
      tags:
        - Payments
      security:
        - BearerAuth: []
  /api/payments/service-status:
    get:
      summary: Get Service Status
      responses:
        "200":
          description: Service status retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      pin_service:
                        type: object
                        properties:
                          available:
                            type: boolean
                          status:
                            type: string
                            enum: [online, offline]
                      sinpe_service:
                        type: object
                        properties:
                          available:
                            type: boolean
                          status:
                            type: string
                            enum: [online, offline]
                      overall_status:
                        type: string
                        enum: [online, partial, offline]
              example:
                success: true
                message: Service status retrieved successfully
                data:
                  pin_service:
                    available: true
                    status: online
                  sinpe_service:
                    available: true
                    status: online
                  overall_status: online
      tags:
        - Payments
      security:
        - BearerAuth: []
  /api/accounts/{id}:
    get:
      summary: Get Account
      responses: {}
      tags:
        - Account
      security:
        - BearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
  /api/accounts:
    get:
      summary: List Accounts
      responses: {}
      tags:
        - Account
      security:
        - BearerAuth: []
    post:
      summary: Create Account
      responses: {}
      tags:
        - Account
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                currency:
                  type: string
            example:
              currency: ""
  /api/accounts/{id}/balance:
    get:
      summary: Get Account Balance
      responses: {}
      tags:
        - Account
      security:
        - BearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
  /api/accounts/{id}/details:
    get:
      summary: Get Account Details
      responses: {}
      tags:
        - Account
      security:
        - BearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
  /api/accounts/{id}/transfers:
    get:
      summary: "[DEPRECATED] List Account Transfers"
      parameters:
        - name: from
          in: query
          schema:
            type: string
          example: "{{from}}"
        - name: to
          in: query
          schema:
            type: string
          example: "{{to}}"
      responses: {}
      tags:
        - Account
      security:
        - BearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
  /api/accounts/{id}/kyc:
    get:
      summary: "[DEPRECATED] Get Account KYC"
      responses: {}
      tags:
        - Account
      security:
        - BearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
  /api/accounts/{id}/transfers/{transferId}:
    get:
      summary: Get Account Transfer By Id
      responses: {}
      tags:
        - Account
      security:
        - BearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
      - name: transferId
        in: path
        required: true
        schema:
          type: string
  /api/phone/information:
    get:
      summary: Verify Phone Is Registered
      parameters:
        - name: phone_number
          in: query
          required: false
          deprecated: false
          schema:
            $ref: "#/components/schemas/CostaRicaPhone"
          example: "88881234"
      responses: {}
      tags:
        - Verification
      security:
        - BearerAuth: []
  /api/iban/information:
    get:
      summary: Verify IBAN Is Registered
      parameters:
        - name: iban
          in: query
          required: false
          deprecated: false
          schema:
            $ref: "#/components/schemas/CostaRicaIBAN"
          example: CR02010200000000000001
      responses: {}
      tags:
        - Verification
      security:
        - BearerAuth: []
  /api/webhooks/subscriptions/{id}:
    get:
      summary: Get Webhook
      responses: {}
      tags:
        - Webhook
      security:
        - BearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    delete:
      summary: Delete Webhook
      responses: {}
      tags:
        - Webhook
      security:
        - BearerAuth: []
  /api/webhooks/subscriptions:
    get:
      summary: List Webhooks
      parameters:
        - name: page
          in: query
          schema:
            type: integer
          example: "1"
      responses: {}
      tags:
        - Webhook
      security:
        - BearerAuth: []
    post:
      summary: Create Webhook
      responses: {}
      tags:
        - Webhook
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                url:
                  type: string
                events:
                  type: string
                max_attempts:
                  type: string
                headers:
                  type: object
                  properties:
                    X-Custom-Header:
                      type: string
            example:
              url: ""
              events: ""
              max_attempts: ""
              headers:
                X-Custom-Header: value
  /api/webhooks/subscriptions/{id}/suspend:
    post:
      summary: Suspend Webhook
      responses: {}
      tags:
        - Webhook
      security:
        - BearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
  /api/webhooks/subscriptions/{id}/resume:
    post:
      summary: Resume Webhook
      responses: {}
      tags:
        - Webhook
      security:
        - BearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
components:
  schemas:
    CostaRicaIBAN:
      type: string
      description: Costa Rican IBAN number
      pattern: '^CR\d{20}$'
      example: CR02010200000000000001
    CostaRicaPhone:
      type: string
      description: Costa Rican phone number (8 digits, starts with 6, 7, or 8)
      pattern: '^[678]\d{7}$'
      example: "88881234"
    CostaRicaNationalID:
      type: string
      description: Costa Rican national ID (Cédula)
      pattern: '^\d{9,10}$'
      example: "0123456789"
    CostaRicaNationalIdentifier:
      type: string
      description: Costa Rican national identifier (Cédula, DIMEX, or Legal Entity)
      example: "111090807"
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
