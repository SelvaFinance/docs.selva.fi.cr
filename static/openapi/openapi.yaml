openapi: 3.0.0
info:
  title: SELVA API
  version: 1.0.0
  description: |
    Soluciones Electr√≥nicas Locales de Valor
    
    The Selva API provides comprehensive financial services including payment processing,
    account management, and webhook subscriptions. All API requests require OAuth 2.0
    authentication using Bearer tokens.
    
    ## Authentication
    
    The API uses OAuth 2.0 for authentication. To get started:
    
    1. Obtain client credentials from the Selva dashboard
    2. Use the `/oauth/authorize` endpoint to initiate the OAuth flow
    3. Exchange the authorization code for an access token using `/oauth/token`
    4. Include the access token in the `Authorization` header as `Bearer {token}`
    
    ## Base URLs
    
    - Production: `https://api.selva.fi.cr`
    - Development: `https://dev.selva.fi.cr`
    - Local: `http://localhost`

servers:
  - url: https://dev.selva.fi.cr
    description: Development server
  - url: http://localhost
    description: Local development server
  - url: '{{URL_API}}'
    description: Custom API URL

tags:
  - name: auth
    description: OAuth 2.0 authentication endpoints
  - name: accounts
    description: Account management operations
  - name: payments
    description: Payment processing and transaction management
  - name: webhooks
    description: Webhook subscription management
  - name: verification
    description: Account and payment verification services

paths:
  /oauth/authorize:
    get:
      operationId: authorize
      summary: OAuth Authorization Endpoint
      description: |
        Initiates the OAuth 2.0 authorization flow. Redirects the user to the
        authorization server where they can grant access to your application.
      tags:
        - auth
      parameters:
        - name: client_id
          in: query
          required: true
          description: Your application's client ID
          schema:
            type: string
            example: 'your-client-id'
        - name: redirect_uri
          in: query
          required: true
          description: The URI to redirect to after authorization
          schema:
            type: string
            format: uri
            example: 'https://your-app.com/callback'
        - name: response_type
          in: query
          required: true
          description: Must be 'code' for authorization code flow
          schema:
            type: string
            enum: [code]
            default: code
        - name: scope
          in: query
          required: false
          description: Space-separated list of scopes
          schema:
            type: string
            example: 'read write'
      responses:
        '302':
          description: Redirect to the authorization server
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /oauth/token:
    post:
      operationId: getToken
      summary: Exchange Authorization Code for Token
      description: |
        Exchanges an authorization code for an access token. This endpoint
        should be called server-side to securely exchange the code.
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TokenRequest'
            example:
              grant_type: authorization_code
              client_id: 'your-client-id'
              client_secret: 'your-client-secret'
              redirect_uri: 'https://your-app.com/callback'
              code: 'authorization-code-from-callback'
      responses:
        '200':
          description: Token exchange successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
              example:
                access_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
                token_type: Bearer
                expires_in: 3600
                refresh_token: 'refresh-token-here'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/payments:
    post:
      operationId: createPayment
      summary: Create Payment
      description: |
        Creates a new payment transaction. Use the X-Idempotency-Key header to
        ensure idempotent requests.
      tags:
        - payments
      parameters:
        - name: X-Idempotency-Key
          in: header
          required: true
          description: Unique key to ensure idempotency of the request
          schema:
            type: string
            format: uuid
            example: '550e8400-e29b-41d4-a716-446655440000'
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentRequest'
            example:
              amount: 10000
              currency: CRC
              recipient_identifier: 'CR78037010600458074353'
              description: 'Payment for services'
              payment_method: 'transfer'
      responses:
        '201':
          description: Payment created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Payment'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/payments/validate:
    post:
      operationId: validatePayment
      summary: Validate Payment
      description: Validates payment details before processing
      tags:
        - payments
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentValidationRequest'
            example:
              amount: 10000
              currency: CRC
              recipient_identifier: 'CR78037010600458074353'
      responses:
        '200':
          description: Payment validation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentValidation'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/payments/history:
    get:
      operationId: getPaymentHistory
      summary: Get Payment History
      description: Retrieves a paginated list of payment transactions
      tags:
        - payments
      security:
        - BearerAuth: []
      parameters:
        - name: limit
          in: query
          required: false
          description: Maximum number of results to return
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
            example: 20
        - name: offset
          in: query
          required: false
          description: Number of results to skip
          schema:
            type: integer
            minimum: 0
            default: 0
            example: 0
        - name: payment_method
          in: query
          required: false
          description: Filter by payment method
          schema:
            type: string
            enum: [transfer, card, cash]
            example: transfer
        - name: transfer_type
          in: query
          required: false
          description: Filter by transfer type
          schema:
            type: string
            example: 'outgoing'
        - name: recipient_identifier
          in: query
          required: false
          description: Filter by recipient identifier
          schema:
            type: string
            example: 'CR78037010600458074353'
      responses:
        '200':
          description: Payment history retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedPayments'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/payments/{id}:
    get:
      operationId: getPayment
      summary: Get Payment by ID
      description: Retrieves details of a specific payment transaction
      tags:
        - payments
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Payment transaction ID
          schema:
            type: string
            example: '550e8400-e29b-41d4-a716-446655440000'
      responses:
        '200':
          description: Payment details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Payment'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/accounts/information:
    get:
      operationId: getAccountInformation
      summary: Get Account Information
      description: Retrieves account information for a given identifier
      tags:
        - accounts
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - identifier
              properties:
                identifier:
                  type: string
                  description: Account identifier (IBAN or account number)
                  example: 'CR78037010600458074353'
                use_internal:
                  type: boolean
                  description: Whether to use internal account lookup
                  default: false
            example:
              identifier: 'CR78037010600458074353'
              use_internal: false
      responses:
        '200':
          description: Account information retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountInformation'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/accounts:
    get:
      operationId: listAccounts
      summary: List Accounts
      description: Retrieves a list of all accounts for the authenticated user
      tags:
        - accounts
      security:
        - BearerAuth: []
      responses:
        '200':
          description: List of accounts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Account'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      operationId: createAccount
      summary: Create Account
      description: Creates a new account for the authenticated user
      tags:
        - accounts
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - currency
              properties:
                currency:
                  type: string
                  description: Currency code (ISO 4217)
                  example: CRC
            example:
              currency: CRC
      responses:
        '201':
          description: Account created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/accounts/{identifier}/information:
    get:
      operationId: getAccountInformationByIdentifier
      summary: Get Account Information by Identifier
      description: Retrieves account information using an account identifier
      tags:
        - accounts
      security:
        - BearerAuth: []
      parameters:
        - name: identifier
          in: path
          required: true
          description: Account identifier (IBAN or account number)
          schema:
            type: string
            example: 'CR78037010600458074353'
      responses:
        '200':
          description: Account information retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountInformation'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/accounts/{id}/balance:
    get:
      operationId: getAccountBalance
      summary: Get Account Balance
      description: Retrieves the current balance for a specific account
      tags:
        - accounts
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Account ID (UUID)
          schema:
            type: string
            format: uuid
            example: '0d330d31-076f-4cb1-b22e-ecc3caeda7a2'
      responses:
        '200':
          description: Account balance
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccountBalance'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/accounts/{id}/details:
    get:
      operationId: getAccountDetails
      summary: Get Account Details
      description: Retrieves detailed information for a specific account
      tags:
        - accounts
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Account ID (UUID)
          schema:
            type: string
            format: uuid
            example: '0d330d31-076f-4cb1-b22e-ecc3caeda7a2'
      responses:
        '200':
          description: Account details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Account'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/accounts/{id}/movements:
    get:
      operationId: getAccountMovements
      summary: Get Account Movements
      description: Retrieves transaction movements for an account within a date range
      tags:
        - accounts
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Account ID (UUID)
          schema:
            type: string
            format: uuid
            example: '0d330d31-076f-4cb1-b22e-ecc3caeda7a2'
        - name: start_date
          in: query
          required: false
          description: Start date for the movement range (ISO 8601)
          schema:
            type: string
            format: date-time
            example: '2024-01-01T00:00:00Z'
        - name: end_date
          in: query
          required: false
          description: End date for the movement range (ISO 8601)
          schema:
            type: string
            format: date-time
            example: '2024-12-31T23:59:59Z'
      responses:
        '200':
          description: Account movements
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AccountMovement'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/accounts/{id}/kyc:
    get:
      operationId: getAccountKYC
      summary: Get Account KYC Status
      description: Retrieves Know Your Customer (KYC) status for an account
      tags:
        - accounts
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Account ID (UUID)
          schema:
            type: string
            format: uuid
            example: '0d330d31-076f-4cb1-b22e-ecc3caeda7a2'
      responses:
        '200':
          description: KYC status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/KYCStatus'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/accounts/{id}/transactions/{transactionCode}:
    get:
      operationId: getTransaction
      summary: Get Transaction by Code
      description: Retrieves a specific transaction by its transaction code
      tags:
        - accounts
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Account ID (UUID)
          schema:
            type: string
            format: uuid
            example: '0d330d31-076f-4cb1-b22e-ecc3caeda7a2'
        - name: transactionCode
          in: path
          required: true
          description: Transaction code
          schema:
            type: string
            example: '123'
      responses:
        '200':
          description: Transaction details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/phone/information:
    get:
      operationId: getPhoneInformation
      summary: Get Phone Number Information
      description: Retrieves information associated with a phone number
      tags:
        - verification
      security:
        - BearerAuth: []
      parameters:
        - name: phone_number
          in: query
          required: true
          description: Phone number to look up
          schema:
            type: string
            example: '+50688888888'
      responses:
        '200':
          description: Phone number information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PhoneInformation'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/iban/information:
    get:
      operationId: getIBANInformation
      summary: Get IBAN Information
      description: Retrieves information for an IBAN (International Bank Account Number)
      tags:
        - verification
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - iban
              properties:
                iban:
                  type: string
                  description: IBAN to look up
                  example: 'CR78037010600458074353'
            example:
              iban: 'CR78037010600458074353'
      responses:
        '200':
          description: IBAN information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IBANInformation'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/webhooks/subscriptions:
    get:
      operationId: listWebhookSubscriptions
      summary: List Webhook Subscriptions
      description: Retrieves a paginated list of webhook subscriptions
      tags:
        - webhooks
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          description: Page number for pagination
          schema:
            type: integer
            minimum: 1
            default: 1
            example: 1
      responses:
        '200':
          description: List of webhook subscriptions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedWebhookSubscriptions'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      operationId: createWebhookSubscription
      summary: Create Webhook Subscription
      description: Creates a new webhook subscription to receive event notifications
      tags:
        - webhooks
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookSubscriptionRequest'
            example:
              url: 'https://your-app.com/webhooks'
              events: 'payment.completed,payment.failed'
              max_attempts: '3'
              headers:
                X-Custom-Header: 'custom-value'
      responses:
        '201':
          description: Webhook subscription created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookSubscription'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/webhooks/subscriptions/{id}:
    get:
      operationId: getWebhookSubscription
      summary: Get Webhook Subscription
      description: Retrieves details of a specific webhook subscription
      tags:
        - webhooks
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Webhook subscription ID (UUID)
          schema:
            type: string
            format: uuid
            example: '53d04104-f130-4901-9ba0-b5fc0d7a2b9d'
      responses:
        '200':
          description: Webhook subscription details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookSubscription'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      operationId: deleteWebhookSubscription
      summary: Delete Webhook Subscription
      description: Deletes a webhook subscription
      tags:
        - webhooks
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Webhook subscription ID (UUID)
          schema:
            type: string
            format: uuid
            example: '53d04104-f130-4901-9ba0-b5fc0d7a2b9d'
      responses:
        '204':
          description: Webhook subscription deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/NotifyIncomingTransfers:
    post:
      operationId: notifyIncomingTransfers
      summary: Incoming Transfer Webhook
      description: |
        Webhook endpoint that receives notifications about incoming transfers.
        This endpoint is called by Selva when transfers are received.
        The request must include a valid Signature header for verification.
      tags:
        - webhooks
      parameters:
        - name: Signature
          in: header
          required: true
          description: HMAC signature for webhook verification
          schema:
            type: string
            example: 'sha256=abc123...'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IncomingTransferNotification'
            example:
              SecurityInfo: 'security-info-string'
              Transfers:
                - CGPRefNumber: 12345
                  SINPERefNumber: '20240101120000000'
                  AuthorizationDate: '2024-01-01T12:00:00Z'
                  OriginEntity: 'BANCO_ORIGEN'
                  OriginCustomer:
                    Id: '123456789'
                    IdType: '01'
                    Name: 'John Doe'
                    IBAN: 'CR12345678901234567890'
                  DestinationCustomer:
                    Id: '987654321'
                    IdType: '01'
                    Name: 'Jane Smith'
                    IBAN: 'CR98765432109876543210'
                  Amount: 10000
                  CurrencyCode: 'CRC'
                  Description: 'Transfer description'
      responses:
        '200':
          description: Webhook received successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: 'received'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/IsServiceAvailable:
    get:
      operationId: checkServiceAvailability
      summary: Check Service Availability
      description: Checks if the API service is currently available
      tags: []
      responses:
        '200':
          description: Service is available
          content:
            application/json:
              schema:
                type: object
                properties:
                  available:
                    type: boolean
                    example: true
                  timestamp:
                    type: string
                    format: date-time
                    example: '2024-01-01T12:00:00Z'
        '503':
          description: Service is unavailable
          content:
            application/json:
              schema:
                type: object
                properties:
                  available:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: 'Service temporarily unavailable'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        OAuth 2.0 Bearer Token authentication. Include the access token
        obtained from the `/oauth/token` endpoint in the Authorization header
        as `Bearer {token}`.

  schemas:
    Error:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Error code
          example: 'invalid_request'
        message:
          type: string
          description: Human-readable error message
          example: 'The request is missing a required parameter'
        details:
          type: object
          description: Additional error details
          additionalProperties: true

    Pagination:
      type: object
      properties:
        limit:
          type: integer
          description: Maximum number of results per page
          example: 20
        offset:
          type: integer
          description: Number of results skipped
          example: 0
        total:
          type: integer
          description: Total number of results
          example: 100
        has_more:
          type: boolean
          description: Whether there are more results available
          example: true

    TokenRequest:
      type: object
      required:
        - grant_type
        - client_id
        - client_secret
      properties:
        grant_type:
          type: string
          enum: [authorization_code]
          description: OAuth grant type
        client_id:
          type: string
          description: Your application's client ID
        client_secret:
          type: string
          description: Your application's client secret
        redirect_uri:
          type: string
          format: uri
          description: The redirect URI used in the authorization request
        code:
          type: string
          description: Authorization code received from the authorization endpoint

    TokenResponse:
      type: object
      required:
        - access_token
        - token_type
      properties:
        access_token:
          type: string
          description: OAuth access token
        token_type:
          type: string
          enum: [Bearer]
          description: Token type
        expires_in:
          type: integer
          description: Token expiration time in seconds
          example: 3600
        refresh_token:
          type: string
          description: Refresh token for obtaining new access tokens
        scope:
          type: string
          description: Granted scopes

    Account:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Account ID
          example: '0d330d31-076f-4cb1-b22e-ecc3caeda7a2'
        identifier:
          type: string
          description: Account identifier (IBAN)
          example: 'CR78037010600458074353'
        currency:
          type: string
          description: Account currency code
          example: CRC
        status:
          type: string
          enum: [active, inactive, suspended]
          description: Account status
        created_at:
          type: string
          format: date-time
          description: Account creation timestamp

    AccountInformation:
      type: object
      properties:
        identifier:
          type: string
          description: Account identifier
          example: 'CR78037010600458074353'
        name:
          type: string
          description: Account holder name
          example: 'John Doe'
        bank:
          type: string
          description: Bank name
          example: 'Banco Nacional'
        verified:
          type: boolean
          description: Whether the account is verified

    AccountBalance:
      type: object
      properties:
        account_id:
          type: string
          format: uuid
          description: Account ID
        balance:
          type: number
          description: Current account balance
          example: 50000.00
        currency:
          type: string
          description: Currency code
          example: CRC
        available_balance:
          type: number
          description: Available balance (excluding holds)
          example: 45000.00
        last_updated:
          type: string
          format: date-time
          description: Last balance update timestamp

    AccountMovement:
      type: object
      properties:
        id:
          type: string
          description: Movement ID
        transaction_code:
          type: string
          description: Transaction code
        amount:
          type: number
          description: Transaction amount
        currency:
          type: string
          description: Currency code
        type:
          type: string
          enum: [credit, debit]
          description: Movement type
        description:
          type: string
          description: Transaction description
        date:
          type: string
          format: date-time
          description: Transaction date

    KYCStatus:
      type: object
      properties:
        account_id:
          type: string
          format: uuid
          description: Account ID
        status:
          type: string
          enum: [pending, verified, rejected]
          description: KYC verification status
        verified_at:
          type: string
          format: date-time
          nullable: true
          description: Verification timestamp
        level:
          type: string
          description: KYC verification level
          example: 'basic'

    Transaction:
      type: object
      properties:
        transaction_code:
          type: string
          description: Transaction code
        account_id:
          type: string
          format: uuid
          description: Account ID
        amount:
          type: number
          description: Transaction amount
        currency:
          type: string
          description: Currency code
        type:
          type: string
          description: Transaction type
        status:
          type: string
          enum: [pending, completed, failed, cancelled]
          description: Transaction status
        description:
          type: string
          description: Transaction description
        created_at:
          type: string
          format: date-time
          description: Transaction creation timestamp

    Payment:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Payment ID
        amount:
          type: number
          description: Payment amount
          example: 10000
        currency:
          type: string
          description: Currency code
          example: CRC
        recipient_identifier:
          type: string
          description: Recipient account identifier
          example: 'CR78037010600458074353'
        status:
          type: string
          enum: [pending, processing, completed, failed, cancelled]
          description: Payment status
        payment_method:
          type: string
          description: Payment method used
          example: transfer
        description:
          type: string
          description: Payment description
        created_at:
          type: string
          format: date-time
          description: Payment creation timestamp
        completed_at:
          type: string
          format: date-time
          nullable: true
          description: Payment completion timestamp

    PaymentRequest:
      type: object
      required:
        - amount
        - currency
        - recipient_identifier
      properties:
        amount:
          type: number
          description: Payment amount in smallest currency unit
          example: 10000
          minimum: 1
        currency:
          type: string
          description: Currency code (ISO 4217)
          example: CRC
        recipient_identifier:
          type: string
          description: Recipient account identifier (IBAN or account number)
          example: 'CR78037010600458074353'
        description:
          type: string
          description: Payment description
          example: 'Payment for services'
        payment_method:
          type: string
          enum: [transfer, card, cash]
          description: Payment method
          default: transfer

    PaymentValidationRequest:
      type: object
      required:
        - amount
        - currency
        - recipient_identifier
      properties:
        amount:
          type: number
          description: Payment amount
          example: 10000
        currency:
          type: string
          description: Currency code
          example: CRC
        recipient_identifier:
          type: string
          description: Recipient account identifier
          example: 'CR78037010600458074353'

    PaymentValidation:
      type: object
      properties:
        valid:
          type: boolean
          description: Whether the payment is valid
        errors:
          type: array
          items:
            type: string
          description: List of validation errors
        warnings:
          type: array
          items:
            type: string
          description: List of validation warnings

    PaginatedPayments:
      allOf:
        - $ref: '#/components/schemas/Pagination'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/Payment'

    PhoneInformation:
      type: object
      properties:
        phone_number:
          type: string
          description: Phone number
          example: '+50688888888'
        verified:
          type: boolean
          description: Whether the phone number is verified
        account_linked:
          type: boolean
          description: Whether the phone is linked to an account

    IBANInformation:
      type: object
      properties:
        iban:
          type: string
          description: IBAN
          example: 'CR78037010600458074353'
        valid:
          type: boolean
          description: Whether the IBAN is valid
        bank:
          type: string
          description: Bank name
          example: 'Banco Nacional'
        account_holder:
          type: string
          description: Account holder name
          example: 'John Doe'

    WebhookSubscription:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Subscription ID
          example: '53d04104-f130-4901-9ba0-b5fc0d7a2b9d'
        url:
          type: string
          format: uri
          description: Webhook URL
          example: 'https://your-app.com/webhooks'
        events:
          type: string
          description: Comma-separated list of subscribed events
          example: 'payment.completed,payment.failed'
        max_attempts:
          type: integer
          description: Maximum retry attempts
          example: 3
        headers:
          type: object
          additionalProperties:
            type: string
          description: Custom headers to include in webhook requests
        active:
          type: boolean
          description: Whether the subscription is active
        created_at:
          type: string
          format: date-time
          description: Subscription creation timestamp

    WebhookSubscriptionRequest:
      type: object
      required:
        - url
        - events
      properties:
        url:
          type: string
          format: uri
          description: Webhook URL to receive notifications
          example: 'https://your-app.com/webhooks'
        events:
          type: string
          description: Comma-separated list of events to subscribe to
          example: 'payment.completed,payment.failed,account.created'
        max_attempts:
          type: string
          description: Maximum number of retry attempts (as string)
          example: '3'
        headers:
          type: object
          additionalProperties:
            type: string
          description: Custom headers to include in webhook requests
          example:
            X-Custom-Header: 'custom-value'

    PaginatedWebhookSubscriptions:
      allOf:
        - $ref: '#/components/schemas/Pagination'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/WebhookSubscription'

    IncomingTransferNotification:
      type: object
      properties:
        SecurityInfo:
          type: string
          description: Security information for verification
        Transfers:
          type: array
          items:
            $ref: '#/components/schemas/Transfer'

    Transfer:
      type: object
      properties:
        CGPRefNumber:
          type: integer
          description: CGP reference number
          example: 12345
        SINPERefNumber:
          type: string
          description: SINPE reference number
          example: '20240101120000000'
        AuthorizationDate:
          type: string
          format: date-time
          description: Transfer authorization date
          example: '2024-01-01T12:00:00Z'
        OriginEntity:
          type: string
          description: Origin bank entity
          example: 'BANCO_ORIGEN'
        OriginCustomer:
          $ref: '#/components/schemas/Customer'
        DestinationCustomer:
          $ref: '#/components/schemas/Customer'
        Amount:
          type: integer
          description: Transfer amount in smallest currency unit
          example: 10000
        CurrencyCode:
          type: string
          description: Currency code
          example: CRC
        Description:
          type: string
          description: Transfer description
          example: 'Transfer description'

    Customer:
      type: object
      properties:
        Id:
          type: string
          description: Customer ID
          example: '123456789'
        IdType:
          type: string
          description: ID type code
          example: '01'
        Name:
          type: string
          description: Customer name
          example: 'John Doe'
        IBAN:
          type: string
          description: Customer IBAN
          example: 'CR12345678901234567890'

  responses:
    BadRequest:
      description: Bad request - Invalid parameters or request body
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: 'invalid_request'
            message: 'The request is missing a required parameter'

    Unauthorized:
      description: Unauthorized - Invalid or missing authentication token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: 'unauthorized'
            message: 'Invalid or expired access token'

    Forbidden:
      description: Forbidden - Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: 'forbidden'
            message: 'You do not have permission to access this resource'

    NotFound:
      description: Not found - Resource does not exist
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: 'not_found'
            message: 'The requested resource was not found'

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: 'internal_error'
            message: 'An internal server error occurred'



